<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class SyntaxTree::Formatter - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
<div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  <p class="link">PrettierPrint
</div>

    
    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-format">::format</a>
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    <li ><a href="#method-i-format">#format</a>
    <li ><a href="#method-i-format_each">#format_each</a>
    <li ><a href="#method-i-parent">#parent</a>
    <li ><a href="#method-i-parents">#parents</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-SyntaxTree::Formatter">
  <h1 id="class-SyntaxTree::Formatter" class="class">
    class SyntaxTree::Formatter
  </h1>

  <section class="description">
    
<p>A slightly enhanced PP that knows how to format recursively including comments.</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section">


    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
        <dt id="COMMENT_PRIORITY">COMMENT_PRIORITY
        <dd>
        <dt id="HEREDOC_PRIORITY">HEREDOC_PRIORITY
        <dd>
        <dt id="OPTIONS">OPTIONS
        <dd><p>We want to minimize as much as possible the number of options that are available in syntax tree. <a href="For.html"><code>For</code></a> the most part, if users want non-default formatting, they should override the format methods on the specific nodes themselves. However, because of some history with prettier and the fact that folks have become entrenched in their ways, we decided to provide a small amount of configurability.</p>

<p>Note that weâ€™re keeping this in a global-ish hash instead of just overriding methods on classes so that other plugins can reference this if necessary. <a href="For.html"><code>For</code></a> example, the RBS plugin references the quote style.</p>
      </dl>
    </section>

    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      <div id="attribute-i-quote" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">quote</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        <p>These options are overridden in plugins to we need to make sure they are available here.</p>
        </div>
      </div>
      <div id="attribute-i-source" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">source</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-stack" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">stack</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-trailing_comma" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">trailing_comma</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        <p>These options are overridden in plugins to we need to make sure they are available here.</p>
        </div>
      </div>
      <div id="attribute-i-trailing_comma-3F" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">trailing_comma?</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        <p>These options are overridden in plugins to we need to make sure they are available here.</p>
        </div>
      </div>
    </section>


     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-format" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">format</span><span
            class="method-args">(source, node)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="format-source">
            <pre><span class="ruby-comment"># File lib/syntax_tree/formatter.rb, line 45</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">format</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">node</span>)
  <span class="ruby-identifier">formatter</span> = <span class="ruby-identifier">new</span>(<span class="ruby-identifier">source</span>, [])
  <span class="ruby-identifier">node</span>.<span class="ruby-identifier">format</span>(<span class="ruby-identifier">formatter</span>)
  <span class="ruby-identifier">formatter</span>.<span class="ruby-identifier">flush</span>
  <span class="ruby-identifier">formatter</span>.<span class="ruby-identifier">output</span>.<span class="ruby-identifier">join</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-new" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">( source, *args, quote: OPTIONS[:quote], trailing_comma: OPTIONS[:trailing_comma] )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>

          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/syntax_tree/formatter.rb, line 29</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(
  <span class="ruby-identifier">source</span>,
  <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>,
  <span class="ruby-value">quote:</span> <span class="ruby-constant">OPTIONS</span>[<span class="ruby-value">:quote</span>],
  <span class="ruby-value">trailing_comma:</span> <span class="ruby-constant">OPTIONS</span>[<span class="ruby-value">:trailing_comma</span>]
)
  <span class="ruby-keyword">super</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)

  <span class="ruby-ivar">@source</span> = <span class="ruby-identifier">source</span>
  <span class="ruby-ivar">@stack</span> = []

  <span class="ruby-comment"># Memoizing these values per formatter to make access faster.</span>
  <span class="ruby-ivar">@quote</span> = <span class="ruby-identifier">quote</span>
  <span class="ruby-ivar">@trailing_comma</span> = <span class="ruby-identifier">trailing_comma</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-format" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">format</span><span
            class="method-args">(node, stackable: true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="format-source">
            <pre><span class="ruby-comment"># File lib/syntax_tree/formatter.rb, line 52</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">format</span>(<span class="ruby-identifier">node</span>, <span class="ruby-value">stackable:</span> <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">stack</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">node</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">stackable</span>
  <span class="ruby-identifier">doc</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-comment"># If there are comments, then we&#39;re going to format them around the node</span>
  <span class="ruby-comment"># so that they get printed properly.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">any?</span>
    <span class="ruby-identifier">leading</span>, <span class="ruby-identifier">trailing</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">partition</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:leading?</span>)

    <span class="ruby-comment"># Print all comments that were found before the node.</span>
    <span class="ruby-identifier">leading</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">comment</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">format</span>(<span class="ruby-keyword">self</span>)
      <span class="ruby-identifier">breakable</span>(<span class="ruby-value">force:</span> <span class="ruby-keyword">true</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># If the node has a stree-ignore comment right before it, then we&#39;re</span>
    <span class="ruby-comment"># going to just print out the node as it was seen in the source.</span>
    <span class="ruby-identifier">doc</span> =
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">leading</span>.<span class="ruby-identifier">last</span>&amp;.<span class="ruby-identifier">ignore?</span>
        <span class="ruby-identifier">range</span> = <span class="ruby-identifier">source</span>[<span class="ruby-identifier">node</span>.<span class="ruby-identifier">location</span>.<span class="ruby-identifier">start_char</span><span class="ruby-operator">...</span><span class="ruby-identifier">node</span>.<span class="ruby-identifier">location</span>.<span class="ruby-identifier">end_char</span>]
        <span class="ruby-identifier">separator</span> = <span class="ruby-operator">-&gt;</span> { <span class="ruby-identifier">breakable</span>(<span class="ruby-value">indent:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">force:</span> <span class="ruby-keyword">true</span>) }
        <span class="ruby-identifier">seplist</span>(<span class="ruby-identifier">range</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\r?\n/</span>, <span class="ruby-value">-1</span>), <span class="ruby-identifier">separator</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">text</span>(<span class="ruby-identifier">line</span>) }
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">node</span>.<span class="ruby-identifier">format</span>(<span class="ruby-keyword">self</span>)
      <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># Print all comments that were found after the node.</span>
    <span class="ruby-identifier">trailing</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">comment</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">line_suffix</span>(<span class="ruby-value">priority:</span> <span class="ruby-constant">COMMENT_PRIORITY</span>) <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">inline?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">text</span>(<span class="ruby-string">&quot; &quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">breakable</span>
        <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">format</span>(<span class="ruby-keyword">self</span>)
        <span class="ruby-identifier">break_parent</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">doc</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">format</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">stack</span>.<span class="ruby-identifier">pop</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">stackable</span>
  <span class="ruby-identifier">doc</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-format_each" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">format_each</span><span
            class="method-args">(nodes)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="format_each-source">
            <pre><span class="ruby-comment"># File lib/syntax_tree/formatter.rb, line 94</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">format_each</span>(<span class="ruby-identifier">nodes</span>)
  <span class="ruby-identifier">nodes</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span> <span class="ruby-identifier">format</span>(<span class="ruby-identifier">node</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-parent" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">parent</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="parent-source">
            <pre><span class="ruby-comment"># File lib/syntax_tree/formatter.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">parent</span>
  <span class="ruby-identifier">stack</span>[<span class="ruby-value">-2</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-parents" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">parents</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="parents-source">
            <pre><span class="ruby-comment"># File lib/syntax_tree/formatter.rb, line 102</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">parents</span>
  <span class="ruby-identifier">stack</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">reverse_each</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.4.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

